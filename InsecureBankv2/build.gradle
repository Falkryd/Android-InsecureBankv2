// Simplified top-level build that reuses the prebuilt APK shipped with the
// repository instead of compiling the Android sources. This avoids downloading
// the Android Gradle Plugin and the Android SDK, which are not available in the
// execution environment.

ext {
    prebuiltApk = rootProject.file('../InsecureBankv2.apk')
}

allprojects {
    tasks.register('verifyPrebuiltApk') {
        inputs.file(rootProject.prebuiltApk)
        doLast {
            if (!rootProject.prebuiltApk.exists()) {
                throw new GradleException("Missing prebuilt APK: ${rootProject.prebuiltApk}")
            }
        }
    }
}

tasks.register('assembleDebug') {
    dependsOn(':app:assembleDebug')
}

tasks.register('clean', Delete) {
    delete rootProject.layout.buildDirectory
    dependsOn(subprojects.collect { it.tasks.matching { task -> task.name == 'clean' } })
}
